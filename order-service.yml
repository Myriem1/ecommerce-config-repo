server:
  port: 0

  cloud:
    openfeign:
      circuitbreaker:
        enabled: false

axon:
  axonserver:
    servers: localhost:8124
    enabled: true
  distributed-command-bus:
    enabled: false
  eventhandling:
    processors:
      order:
        mode: tracking
    tokenstore:
      jpa:
        enabled: true

feign:
  client:
    config:
      default:
        connectTimeout: 3000
        readTimeout: 3000

resilience4j:
  circuitbreaker:
    instances:
      productCommand:
        failureRateThreshold: 30
        slidingWindowSize: 5
        minimumNumberOfCalls: 3
        waitDurationInOpenState: 10s

  retry:
    instances:
      productCommand:
        maxAttempts: 3
        waitDuration: 500ms
        retryExceptions:
          - feign.FeignException
          - java.net.ConnectException
          - java.net.SocketTimeoutException
        ignoreExceptions:
          - org.springframework.web.server.ResponseStatusException

  ratelimiter:
    instances:
      productCommand:
        limitForPeriod: 5
        limitRefreshPeriod: 1s
        timeoutDuration: 0

logging:
  level:
    # ===== AXON =====
    org.axonframework: DEBUG

    # ===== YOUR APP =====
    com.orderservice: DEBUG

    # ===== RESILIENCE4J (TARGETED) =====
    io.github.resilience4j.retry: DEBUG
    io.github.resilience4j.circuitbreaker: DEBUG
    io.github.resilience4j.spring6.retry: DEBUG
    io.github.resilience4j.spring6.circuitbreaker: DEBUG

    # ===== FEIGN =====
    feign.Logger: DEBUG
    org.springframework.cloud.openfeign: DEBUG


management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,circuitbreakers,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
  endpoint:
    health:
      show-details: always
